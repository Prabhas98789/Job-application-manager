<!DOCTYPE html>
<html lang="en" class="bg-gray-100 text-gray-900">
<head>
  <meta charset="UTF-8" />
  <title>Create New Job Post</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen p-6 flex items-center justify-center">
  <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-2xl space-y-6">
    <h1 class="text-2xl font-bold text-center">Create New Job Post</h1>
    
    <form id="jobForm" class="space-y-4" enctype="multipart/form-data">
      <!-- Job Title -->
      <input type="text" name="job_title" placeholder="Job Title" required class="border rounded p-2 w-full" />

      <!-- Workplace -->
      <select name="workplace" required class="border rounded p-2 w-full">
        <option value="">Select Workplace</option>
        <option value="ON_SITE">On-Site</option>
        <option value="HYBRID">Hybrid</option>
        <option value="REMOTE">Remote</option>
      </select>

      <!-- Email -->
      <input type="email" name="email" placeholder="Your Email" required class="border rounded p-2 w-full" />

      <!-- Experience -->
      <input type="number" name="experience_years" placeholder="Experience (Years)" required class="border rounded p-2 w-full" />

      <!-- Key Skills -->
      <input type="text" name="key_skills" placeholder="Key Skills (comma separated)" required class="border rounded p-2 w-full" />

      <!-- Modes of Search -->
      <label class="block text-sm font-medium">Modes of Search (Ctrl+Click for multiple):</label>
      <select name="modes_of_search" multiple required class="border rounded p-2 w-full">
        <option value="Telegram">Telegram</option>
        <option value="Social Media posting">Social Media posting</option>
        <option value="Linkedin Job posting">LinkedIn Job posting</option>
        <option value="Whatsapp Groups">WhatsApp Groups</option>
      </select>

      <!-- JD Upload -->
      <label class="block text-sm font-medium mt-4">Upload JD (PDF only):</label>
      <input type="file" name="jd_file" accept="application/pdf" required class="border rounded p-2 w-full" />

      <!-- Submit -->
      <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded w-full">
        Submit Job Post
      </button>
    </form>

    <div id="status" class="text-center text-sm text-gray-600"></div>
  </div>

  <script>
    document.getElementById("jobForm").onsubmit = async (e) => {
      e.preventDefault();
      const form = e.target;
      const formData = new FormData(form);
      const statusEl = document.getElementById("status");
      statusEl.innerText = "Submitting job post...";

      try {
        const res = await fetch("https://n8n.sapidblue.in/form/52fed556-6cbd-49d2-9172-dc79925b787a", {
          method: "POST",
          body: formData
        });

        // Option A: Redirect is configured in n8n form
        if (res.redirected) {
          window.location.href = res.url;
          return;
        }

        // Option B: Manually handle response (e.g., GPT generated JD)
        const result = await res.json();
        if (result.jd_base64 && result.job_id) {
          const url = `review-jd.html?jd=${encodeURIComponent(result.jd_base64)}&job_id=${result.job_id}`;
          window.location.href = url;
        } else {
          statusEl.innerText = "✅ Submitted. No redirect configured.";
        }
      } catch (err) {
        console.error("Submission error:", err);
        statusEl.innerText = "❌ Failed to submit. Please try again.";
      }
    };
  </script>
</body>
</html>
